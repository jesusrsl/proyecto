{% extends 'base.html' %}

{% block js %}
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <!--se repite porque si no da error -->
    <script>
    var formAjaxSubmit = function(form, modal) {
     $(form).submit(function (e) {
         e.preventDefault();
         $.ajax({
             type: $(this).attr('method'),
             url: $(this).attr('action'),
             data: $(this).serialize(),
             success: function (xhr, ajaxOptions, thrownError) {
                 if ( $(xhr).find('.has-error').length > 0 ) {
                     $(modal).find('.modal-body').html(xhr);
                     formAjaxSubmit(form, modal);
                 } else {
                     $(modal).modal('toggle');

                     alert("Anotación creada correctamente")

                     location.reload(); //se recarga la página (en AJAX NO es recomendable)

                 }
             },
             error: function (xhr, ajaxOptions, thrownError) {
                 // handle response errors here
                }
             });
        });
    }


    </script>

    {% endblock %}

{% block section %}

    <h2>Profesores</h2>
    <hr>

{% endblock %}

{% block maincontent %}
    <div>
        {% for p in object_list %}
            <a href="{% url 'detalle-profesor' p.id %}">
                {{ p.nombre | capfirst}} {{ p.apellidos | capfirst}}
            </a>
            <br>
        {% endfor %}
    <hr>
    <a href="{%  url 'nuevo-profesor' %}">Nuevo profesor/a</a>
    <br>
    <a id="comment-button" href="#">Nuevo profesor/a en ventana modal </a>
    <script>
        $('#comment-button').click(function() {
                $('#form-modal-body').load(document.getElementById("url").value, function () {
                    $('#form-modal').modal('toggle');
                    formAjaxSubmit('#form-modal-body form', '#form-modal');
                });
            });
    </script>


    <input type="hidden" id="url" name="url" value="{% url 'new-teacher' %}" readonly>



   <div id="form-modal" class="modal fade">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Nuevo profesor</h4>
                    </div>
                    <div id="form-modal-body" class="modal-body">
                        <p>Contenido del formulario</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->


    </div>



{% endblock %}